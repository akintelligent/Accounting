# Accounting_erp
MERN+ORACLE DB 23ai 
===
Database SQL:


  CREATE TABLE "ACCOUNTING_DB"."USERS" 
   (	"USER_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"EMP_ID" NUMBER NOT NULL ENABLE, 
	"USERNAME" VARCHAR2(50 BYTE) NOT NULL ENABLE, 
	"PASSWORD_HASH" VARCHAR2(200 BYTE) NOT NULL ENABLE, 
	"ROLE_ID" NUMBER NOT NULL ENABLE, 
	"IS_ACTIVE" CHAR(1 BYTE) DEFAULT 'Y', 
	"CREATED_AT" DATE DEFAULT SYSDATE, 
	 CHECK (IS_ACTIVE IN ('Y', 'N')) ENABLE, 
	 PRIMARY KEY ("USER_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 UNIQUE ("USERNAME")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 FOREIGN KEY ("EMP_ID")
	  REFERENCES "ACCOUNTING_DB"."EMPLOYEES" ("EMP_ID") ENABLE, 
	 FOREIGN KEY ("ROLE_ID")
	  REFERENCES "ACCOUNTING_DB"."USER_ROLES" ("ROLE_ID") ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

=============

  CREATE TABLE "ACCOUNTING_DB"."USER_ROLES" 
   (	"ROLE_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"ROLE_NAME" VARCHAR2(50 BYTE) NOT NULL ENABLE, 
	"DESCRIPTION" VARCHAR2(200 BYTE), 
	 PRIMARY KEY ("ROLE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 UNIQUE ("ROLE_NAME")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

=====


  CREATE TABLE "ACCOUNTING_DB"."ENTRY_NO_COUNTER" 
   (	"COUNTER_DATE" DATE, 
	"LAST_SERIAL" NUMBER, 
	 PRIMARY KEY ("COUNTER_DATE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

=====

  CREATE TABLE "ACCOUNTING_DB"."EMPLOYEES" 
   (	"EMP_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"EMP_CODE" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"EMP_NAME" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"EMAIL" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"PHONE" VARCHAR2(20 BYTE), 
	"DESIGNATION" VARCHAR2(100 BYTE), 
	"STATUS" CHAR(1 BYTE) DEFAULT 'A', 
	"CREATED_AT" DATE DEFAULT SYSDATE, 
	"PHOTO_URL" VARCHAR2(200 BYTE), 
	 CHECK (STATUS IN ('A', 'I')) ENABLE, 
	 PRIMARY KEY ("EMP_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 UNIQUE ("EMP_CODE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 UNIQUE ("EMAIL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

  CREATE OR REPLACE EDITIONABLE TRIGGER "ACCOUNTING_DB"."TRG_EMP_CODE_AI" 
BEFORE INSERT ON "EMPLOYEES"
FOR EACH ROW
DECLARE
    v_prefix  VARCHAR2(10);
    v_last_code VARCHAR2(20);
    v_next_num NUMBER := 1;
BEGIN
    -- Prefix: MMDDYY
    v_prefix := TO_CHAR(SYSDATE, 'MMDDYY');

    -- Get the last EMP_CODE for today
    SELECT MAX(EMP_CODE)
    INTO v_last_code
    FROM EMPLOYEES
    WHERE SUBSTR(EMP_CODE, 1, 6) = v_prefix;

    -- If exists, increment the last 2 digits
    IF v_last_code IS NOT NULL THEN
        v_next_num := TO_NUMBER(SUBSTR(v_last_code, 7, 2)) + 1;
    END IF;

    -- Assign new EMP_CODE (MMDDYY + 2-digit)
    :NEW.EMP_CODE := v_prefix || LPAD(v_next_num, 2, '0');
END;
/
ALTER TRIGGER "ACCOUNTING_DB"."TRG_EMP_CODE_AI" ENABLE;

====

  CREATE TABLE "ACCOUNTING_DB"."ACC_CHART_OF_ACCOUNTS" 
   (	"ACCOUNT_ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"ACCOUNT_NAME" VARCHAR2(200 BYTE) NOT NULL ENABLE, 
	"ACCOUNT_TYPE" VARCHAR2(50 BYTE), 
	"PARENT_ACCOUNT_ID" NUMBER, 
	"ACCOUNT_CODE" VARCHAR2(50 BYTE), 
	"STATUS" CHAR(1 BYTE) DEFAULT 'A', 
	"LEVEL_NO" NUMBER DEFAULT 1, 
	"CREATED_AT" DATE DEFAULT SYSDATE, 
	"UPDATED_AT" DATE, 
	 CHECK (ACCOUNT_TYPE IN ('Asset', 'Liability', 'Equity', 'Income', 'Expense')) ENABLE, 
	 CHECK (STATUS IN ('A','I')) ENABLE, 
	 PRIMARY KEY ("ACCOUNT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 UNIQUE ("ACCOUNT_CODE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 CONSTRAINT "FK_PARENT_ACCOUNT" FOREIGN KEY ("PARENT_ACCOUNT_ID")
	  REFERENCES "ACCOUNTING_DB"."ACC_CHART_OF_ACCOUNTS" ("ACCOUNT_ID") ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

  CREATE OR REPLACE EDITIONABLE TRIGGER "ACCOUNTING_DB"."TRG_COA_AUTO_CODE" 
BEFORE INSERT ON ACC_CHART_OF_ACCOUNTS
FOR EACH ROW
DECLARE
    v_prefix VARCHAR2(10);
    v_next_no NUMBER;
    v_parent_code VARCHAR2(50);
BEGIN
    -- Set Level
    IF :NEW.PARENT_ACCOUNT_ID IS NOT NULL THEN
        SELECT LEVEL_NO + 1, ACCOUNT_CODE INTO :NEW.LEVEL_NO, v_parent_code
        FROM ACC_CHART_OF_ACCOUNTS
        WHERE ACCOUNT_ID = :NEW.PARENT_ACCOUNT_ID;

        -- Generate child code: ParentCode + '-' + next 2 digits
        SELECT NVL(MAX(TO_NUMBER(SUBSTR(ACCOUNT_CODE, LENGTH(v_parent_code)+2))), 0) + 1
        INTO v_next_no
        FROM ACC_CHART_OF_ACCOUNTS
        WHERE PARENT_ACCOUNT_ID = :NEW.PARENT_ACCOUNT_ID;

        :NEW.ACCOUNT_CODE := v_parent_code || '-' || LPAD(v_next_no, 2, '0');
    ELSE
        -- Generate root account code (like A001, L001, etc.)
        CASE :NEW.ACCOUNT_TYPE
            WHEN 'Asset' THEN v_prefix := 'A';
            WHEN 'Liability' THEN v_prefix := 'L';
            WHEN 'Equity' THEN v_prefix := 'E';
            WHEN 'Income' THEN v_prefix := 'I';
            WHEN 'Expense' THEN v_prefix := 'X';
        END CASE;

        SELECT NVL(MAX(TO_NUMBER(SUBSTR(ACCOUNT_CODE, 2))), 0) + 1
        INTO v_next_no
        FROM ACC_CHART_OF_ACCOUNTS
        WHERE ACCOUNT_TYPE = :NEW.ACCOUNT_TYPE
          AND PARENT_ACCOUNT_ID IS NULL;

        :NEW.ACCOUNT_CODE := v_prefix || LPAD(v_next_no, 3, '0');
        :NEW.LEVEL_NO := 1;
    END IF;
END;
/
ALTER TRIGGER "ACCOUNTING_DB"."TRG_COA_AUTO_CODE" ENABLE;

===
Journal Entry System :

CREATE TABLE ACC_JOURNAL_ENTRIES (
  ENTRY_ID       NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  ENTRY_NO       VARCHAR2(50) UNIQUE,
  ENTRY_DATE     DATE NOT NULL,
  VOUCHER_TYPE   VARCHAR2(50), -- Journal, Payment, Receipt, Contra
  DESCRIPTION    VARCHAR2(1000),
  STATUS         CHAR(1) DEFAULT 'U', -- U = Unposted/Draft, P = Posted
  CREATED_BY     VARCHAR2(100),
  CREATED_AT     TIMESTAMP DEFAULT SYSTIMESTAMP,
  UPDATED_AT     TIMESTAMP
);
/
CREATE TABLE entry_no_counter (
    counter_date DATE PRIMARY KEY,
    last_serial NUMBER
);
/
CREATE TABLE ACC_JOURNAL_LINES (
  LINE_ID      NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  ENTRY_ID     NUMBER NOT NULL,
  ACCOUNT_ID   NUMBER NOT NULL,
  NARRATION    VARCHAR2(500),
  DEBIT        NUMBER(18,2) DEFAULT 0,
  CREDIT       NUMBER(18,2) DEFAULT 0,
  CREATED_AT   TIMESTAMP DEFAULT SYSTIMESTAMP,
  CONSTRAINT FK_JL_ENTRY FOREIGN KEY (ENTRY_ID) REFERENCES ACC_JOURNAL_ENTRIES (ENTRY_ID) ON DELETE CASCADE,
  CONSTRAINT FK_JL_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACC_CHART_OF_ACCOUNTS (ACCOUNT_ID)
);
/

Trigger:

CREATE OR REPLACE TRIGGER trg_journal_entries_entry_no
BEFORE INSERT ON ACC_JOURNAL_ENTRIES
FOR EACH ROW
DECLARE
    v_serial NUMBER;
BEGIN
    IF :NEW.entry_date IS NULL THEN
        :NEW.entry_date := SYSDATE;
    END IF;

    -- Get or initialize counter
    BEGIN
        SELECT last_serial + 1
        INTO v_serial
        FROM entry_no_counter
        WHERE counter_date = TRUNC(:NEW.entry_date)
        FOR UPDATE;

        UPDATE entry_no_counter
        SET last_serial = v_serial
        WHERE counter_date = TRUNC(:NEW.entry_date);
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            v_serial := 1;
            INSERT INTO entry_no_counter (counter_date, last_serial)
            VALUES (TRUNC(:NEW.entry_date), v_serial);
    END;

    -- Format ENTRY_NO: JV + DDMMYY + 4-digit serial
    :NEW.entry_no := 'JV' ||
                      TO_CHAR(:NEW.entry_date, 'DDMMYY') ||
                      LPAD(v_serial, 4, '0');
END;
/


CREATE TABLE ACC_LEDGERS (
    LEDGER_ID     NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    ACCOUNT_ID    NUMBER NOT NULL,
    ENTRY_ID      NUMBER NOT NULL,
    ENTRY_NO      VARCHAR2(50),
    ENTRY_DATE    DATE NOT NULL,
    VOUCHER_TYPE  VARCHAR2(50),
    PARTICULARS   VARCHAR2(500),
    DEBIT         NUMBER(18,2) DEFAULT 0,
    CREDIT        NUMBER(18,2) DEFAULT 0,
    BALANCE       NUMBER(18,2) DEFAULT 0,
    CREATED_AT    TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_LEDGER_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACC_CHART_OF_ACCOUNTS (ACCOUNT_ID),
    CONSTRAINT FK_LEDGER_ENTRY FOREIGN KEY (ENTRY_ID) REFERENCES ACC_JOURNAL_ENTRIES (ENTRY_ID)
);
/


===

